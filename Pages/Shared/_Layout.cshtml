@using TaxHelperToday.Infrastructure.Data
@inject ApplicationDbContext DbContext
@{
    var pageValue = ViewContext.RouteData.Values["page"]?.ToString()?.ToLower().Replace("/", "") ?? "home";
    if (pageValue == "index" || pageValue == "") pageValue = "home";
    if (pageValue == "blogdetail") pageValue = "blog-detail";
    if (pageValue == "servicedetail") pageValue = "service-detail";
    if (pageValue == "privacypolicy") pageValue = "privacy";
    if (pageValue == "termsconditions") pageValue = "terms";
    if (pageValue == "trustsafety") pageValue = "trust-safety";
    
    var settings = DbContext.AdminSettings.ToList();
    var siteName = settings.FirstOrDefault(s => s.Key == "site_name")?.Value ?? "TaxHelperToday";
    var siteLogoRaw = settings.FirstOrDefault(s => s.Key == "site_logo_url")?.Value ?? "~/img/logo.png";
    var siteLogoIsExternal = siteLogoRaw.StartsWith("http://", StringComparison.OrdinalIgnoreCase) ||
                             siteLogoRaw.StartsWith("https://", StringComparison.OrdinalIgnoreCase);

    string ResolveAssetUrl(string raw)
    {
        if (string.IsNullOrWhiteSpace(raw)) return Url.Content("~/img/logo.png");
        return raw.StartsWith("http://", StringComparison.OrdinalIgnoreCase) || raw.StartsWith("https://", StringComparison.OrdinalIgnoreCase)
            ? raw
            : Url.Content(raw);
    }

    var siteLogoUrl = ResolveAssetUrl(siteLogoRaw);
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@(ViewData["Title"] != null ? ViewData["Title"] + " - " : "")@siteName | Smart Tax Compliance & Planning</title>

    @if (siteLogoIsExternal)
    {
        <link rel="icon" type="image/png" href="@siteLogoUrl" />
        <link rel="shortcut icon" type="image/png" href="@siteLogoUrl" />
    }
    else
    {
        <link rel="icon" type="image/png" href="@siteLogoUrl" asp-append-version="true" />
        <link rel="shortcut icon" type="image/png" href="@siteLogoUrl" asp-append-version="true" />
    }

    <link rel="stylesheet" href="~/css/style.css" asp-append-version="true" />
</head>
<body data-page="@pageValue">
    @await Html.PartialAsync("_Header")

    <main>
        @RenderBody()
    </main>

    @await Html.PartialAsync("_Footer")

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="~/js/main.js" asp-append-version="true"></script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
